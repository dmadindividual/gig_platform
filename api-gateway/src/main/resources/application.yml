spring:
  application:
    name: api-gateway

  # Redis for rate limiting
  data:
    redis:
      host: localhost
      port: 6379

  # Gateway routes configuration
  cloud:
    gateway:
      routes:
        # User Service routes
        - id: user-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/users/**,/api/auth/**
          filters:
            - name: CircuitBreaker
              args:
                name: userServiceCircuitBreaker
                fallbackUri: forward:/fallback/user-service

        # Worker Service routes
        - id: worker-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/workers/**
          filters:
            - name: CircuitBreaker
              args:
                name: workerServiceCircuitBreaker

        # Gig Service routes
        - id: gig-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/gigs/**,/api/bids/**
          filters:
            - name: CircuitBreaker
              args:
                name: gigServiceCircuitBreaker

        # Payment Service routes
        - id: payment-service
          uri: http://localhost:8084
          predicates:
            - Path=/api/payments/**,/api/transactions/**
          filters:
            - name: CircuitBreaker
              args:
                name: paymentServiceCircuitBreaker

      # Global CORS configuration
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: "http://localhost:3000,http://localhost:4200"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - PATCH
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
            maxAge: 3600

server:
  port: 8080

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,gateway
  endpoint:
    health:
      show-details: always
  zipkin:
    tracing:
      endpoint: http://localhost:9411/api/v2/spans

# Resilience4j Circuit Breaker configuration
resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        waitDurationInOpenState: 10s
        failureRateThreshold: 50
        slowCallRateThreshold: 100
        slowCallDurationThreshold: 2s
    instances:
      userServiceCircuitBreaker:
        baseConfig: default
      workerServiceCircuitBreaker:
        baseConfig: default
      gigServiceCircuitBreaker:
        baseConfig: default
      paymentServiceCircuitBreaker:
        baseConfig: default

logging:
  level:
    root: INFO
    com.gigplatform: DEBUG
    org.springframework.cloud.gateway: DEBUG